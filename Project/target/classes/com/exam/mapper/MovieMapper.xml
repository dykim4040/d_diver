<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.exam.mapper.MovieMapper">

	<select id="getMovies" resultType="MovieVO">
		SELECT * 
		FROM d_diver.movie
		<where>
			<if test="search != null and search != ''">
				movie_nm LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="repNationNm != null and repNationNm != ''">
				AND rep_genre_nm = #{repNationNm}
			</if>
		</where>
		ORDER BY movie_nm ASC
		LIMIT #{amount} OFFSET #{startRow}
	</select>
	
	<select id="getMovieCount" resultType="int">
		SELECT COUNT(*) 
		FROM d_diver.movie
		<where>
			<if test="search != null and search != ''">
				movie_nm LIKE CONCAT('%', #{search}, '%')
			</if>
			<if test="repNationNm != null and repNationNm != ''">
				AND rep_genre_nm = #{repNationNm}
			</if>
		</where>
	</select>
	
	<select id="getMovie" resultType="MovieVO">
		SELECT * FROM d_diver.movie WHERE movie_cd = #{movieCd}
	</select>
	
	<select id="getCompaniesIn" resultType="CompaniesInVO">
		SELECT * FROM d_diver.companies_in WHERE movie_cd = #{movieCd}
	</select>
	
	<select id="getDirectorsIn" resultType="DirectorsInVO">
		SELECT * FROM d_diver.directors_in WHERE movie_cd = #{movieCd}
	</select>
	
	<select id="getMovieGenre" resultType="MovieGenreVO">
		SELECT * FROM d_diver.movie_genre WHERE movie_cd = #{movieCd}
	</select> 
	
	<select id="getMovieStillCut" resultType="MovieStillCutVO">
		SELECT * FROM d_diver.movie_still_cut WHERE movie_cd = #{movieCd}
	</select> 
	
	<select id="getStarsIn" resultType="StarsInVO">
		SELECT * FROM d_diver.stars_in WHERE movie_cd = #{movieCd}
	</select> 
	
	<update id="updateAvgScore">
		UPDATE d_diver.movie SET avg_score = #{avg_score} WHERE movie_cd = #{movieCd}
	</update>
	
</mapper>  